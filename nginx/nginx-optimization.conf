# Оптимизации для /etc/nginx/nginx.conf
# Добавьте эти настройки в секцию http {} основного конфига Nginx

# Worker processes и connections
worker_processes auto;  # Автоматически по количеству CPU ядер
worker_rlimit_nofile 65535;  # Максимум открытых файлов

events {
    worker_connections 4096;  # Увеличено для большого количества клиентов
    use epoll;  # Эффективный метод для Linux
    multi_accept on;  # Принимать несколько соединений за раз
}

http {
    # Оптимизация для больших файлов
    sendfile on;
    sendfile_max_chunk 2m;  # Отправлять по 2MB за раз (оптимально для видео)
    tcp_nopush on;
    tcp_nodelay on;
    
    # Таймауты
    keepalive_timeout 65;
    keepalive_requests 1000;  # Больше запросов на одно соединение
    
    # Буферы для больших файлов
    client_body_buffer_size 256k;
    client_header_buffer_size 4k;
    large_client_header_buffers 8 16k;
    
    # Кэш открытых файлов (критично для production!)
    open_file_cache max=10000 inactive=30s;
    open_file_cache_valid 60s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
    
    # Gzip для текстовых файлов (не для видео)
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript 
               application/json application/javascript application/xml+rss 
               application/rss+xml font/truetype font/opentype 
               application/vnd.ms-fontobject image/svg+xml;
    gzip_disable "msie6";
    
    # Отключаем gzip для видео и изображений
    gzip_disable "MSIE [1-6]\.";
}


# VideoControl TV - PowerShell Build Script
# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° APK Ğ´Ğ»Ñ Android TV

Write-Host ""
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host "  ğŸ“± VideoControl TV - Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° APK" -ForegroundColor Cyan
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡Ñ‚Ğ¾ Ğ¼Ñ‹ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
if (-Not (Test-Path ".\gradlew.bat")) {
    Write-Host "âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: gradlew.bat Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!" -ForegroundColor Red
    Write-Host "   Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¸Ğ· Ğ¿Ğ°Ğ¿ĞºĞ¸ VideoControlTV" -ForegroundColor Yellow
    Write-Host ""
    exit 1
}

# ĞœĞµĞ½Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ‚Ğ¸Ğ¿Ğ° ÑĞ±Ğ¾Ñ€ĞºĞ¸
Write-Host "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ ÑĞ±Ğ¾Ñ€ĞºĞ¸:" -ForegroundColor Yellow
Write-Host "  [1] Debug APK (Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)" -ForegroundColor White
Write-Host "  [2] Release APK (Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ°)" -ForegroundColor White
Write-Host "  [3] Clean + Debug" -ForegroundColor White
Write-Host "  [4] Clean + Release" -ForegroundColor White
Write-Host ""

$choice = Read-Host "Ğ’Ğ°Ñˆ Ğ²Ñ‹Ğ±Ğ¾Ñ€ (1-4)"

# ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ ÑĞ±Ğ¾Ñ€ĞºĞ¸
switch ($choice) {
    "1" {
        Write-Host ""
        Write-Host "ğŸ”¨ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Debug APK..." -ForegroundColor Green
        $buildType = "assembleDebug"
        $outputPath = "app\build\outputs\apk\debug\app-debug.apk"
    }
    "2" {
        Write-Host ""
        Write-Host "ğŸ”¨ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Release APK..." -ForegroundColor Green
        $buildType = "assembleRelease"
        $outputPath = "app\build\outputs\apk\release\app-release-unsigned.apk"
    }
    "3" {
        Write-Host ""
        Write-Host "ğŸ§¹ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°..." -ForegroundColor Yellow
        & .\gradlew.bat clean
        Write-Host "ğŸ”¨ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Debug APK..." -ForegroundColor Green
        $buildType = "assembleDebug"
        $outputPath = "app\build\outputs\apk\debug\app-debug.apk"
    }
    "4" {
        Write-Host ""
        Write-Host "ğŸ§¹ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°..." -ForegroundColor Yellow
        & .\gradlew.bat clean
        Write-Host "ğŸ”¨ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Release APK..." -ForegroundColor Green
        $buildType = "assembleRelease"
        $outputPath = "app\build\outputs\apk\release\app-release-unsigned.apk"
    }
    default {
        Write-Host ""
        Write-Host "âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€!" -ForegroundColor Red
        exit 1
    }
}

Write-Host ""
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan

# Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞ±Ğ¾Ñ€ĞºĞ¸
$startTime = Get-Date

try {
    & .\gradlew.bat $buildType
    
    if ($LASTEXITCODE -eq 0) {
        $endTime = Get-Date
        $duration = $endTime - $startTime
        
        Write-Host ""
        Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
        Write-Host "  âœ… Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!" -ForegroundColor Green
        Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
        Write-Host ""
        Write-Host "â±ï¸  Ğ’Ñ€ĞµĞ¼Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸: $($duration.Minutes)Ğ¼ $($duration.Seconds)Ñ" -ForegroundColor Cyan
        Write-Host ""
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ APK
        if (Test-Path $outputPath) {
            $apkSize = (Get-Item $outputPath).Length / 1MB
            $apkSizeFormatted = "{0:N2}" -f $apkSize
            $fullPath = (Resolve-Path $outputPath).Path
            
            Write-Host "ğŸ“¦ APK Ñ„Ğ°Ğ¹Ğ»:" -ForegroundColor Yellow
            Write-Host "   ĞŸÑƒÑ‚ÑŒ: $fullPath" -ForegroundColor White
            Write-Host "   Ğ Ğ°Ğ·Ğ¼ĞµÑ€: $apkSizeFormatted MB" -ForegroundColor White
            Write-Host ""
            
            # ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ
            Write-Host "ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ APK? (y/n): " -NoNewline -ForegroundColor Yellow
            $openFolder = Read-Host
            
            if ($openFolder -eq "y" -or $openFolder -eq "Y") {
                $folderPath = Split-Path $fullPath
                Start-Process explorer.exe -ArgumentList $folderPath
            }
            
            # ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· ADB
            Write-Host ""
            Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
            Write-Host "  ğŸ“² Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ½Ğ° Android TV" -ForegroundColor Cyan
            Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
            Write-Host ""
            Write-Host "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ APK Ñ‡ĞµÑ€ĞµĞ· ADB? (y/n): " -NoNewline -ForegroundColor Yellow
            $installAdb = Read-Host
            
            if ($installAdb -eq "y" -or $installAdb -eq "Y") {
                Write-Host ""
                Write-Host "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ IP Ğ°Ğ´Ñ€ĞµÑ Android TV: " -NoNewline -ForegroundColor Yellow
                $tvIp = Read-Host
                
                if ($tvIp) {
                    Write-Host ""
                    Write-Host "ğŸ”Œ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº TV..." -ForegroundColor Cyan
                    adb connect "${tvIp}:5555"
                    
                    Write-Host "ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° APK..." -ForegroundColor Cyan
                    adb install -r $fullPath
                    
                    if ($LASTEXITCODE -eq 0) {
                        Write-Host ""
                        Write-Host "âœ… APK ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½!" -ForegroundColor Green
                        Write-Host ""
                        Write-Host "Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ? (y/n): " -NoNewline -ForegroundColor Yellow
                        $launchApp = Read-Host
                        
                        if ($launchApp -eq "y" -or $launchApp -eq "Y") {
                            Write-Host "ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ..." -ForegroundColor Cyan
                            adb shell am start -n com.videocontrol.tv/.MainActivity
                            Write-Host ""
                            Write-Host "âœ… ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ Ğ½Ğ° TV!" -ForegroundColor Green
                        }
                    } else {
                        Write-Host ""
                        Write-Host "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ APK" -ForegroundColor Red
                        Write-Host "   ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº TV Ğ¸ USB Debugging" -ForegroundColor Yellow
                    }
                }
            }
            
        } else {
            Write-Host "âš ï¸  APK Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ğ¾ Ğ¿ÑƒÑ‚Ğ¸: $outputPath" -ForegroundColor Yellow
        }
        
    } else {
        Write-Host ""
        Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
        Write-Host "  âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ±Ğ¾Ñ€ĞºĞ¸!" -ForegroundColor Red
        Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
        Write-Host ""
        Write-Host "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ²Ñ‹ÑˆĞµ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸." -ForegroundColor Yellow
        exit 1
    }
    
} catch {
    Write-Host ""
    Write-Host "âŒ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: $_" -ForegroundColor Red
    exit 1
}

Write-Host ""
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host "  ğŸ‰ Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!" -ForegroundColor Cyan
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""


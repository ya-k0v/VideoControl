# üß™ –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ VideoControl
**–î–∞—Ç–∞:** 2025-11-13  
**–í–µ—Ä—Å–∏—è:** v2.6.2-dev  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–û–ô–î–ï–ù

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –¢–µ—Å—Ç 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–ë–î + Shared Storage)
**–°—Ç–∞—Ç—É—Å:** –ü–†–û–ô–î–ï–ù

- **–ë–î metadata:** 6 –∑–∞–ø–∏—Å–µ–π
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 4 —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** 2 —Ñ–∞–π–ª–∞ (33% —ç–∫–æ–Ω–æ–º–∏—è)
- **–ü—Ä–∏–º–µ—Ä—ã:**
  - `KLIP.mp4` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (ATV001, br001, vA001)
  - `1.jpg` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º (ATV001)

**–í—ã–≤–æ–¥:** ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### ‚úÖ –¢–µ—Å—Ç 2: API Endpoints
**–°—Ç–∞—Ç—É—Å:** –ü–†–û–ô–î–ï–ù

- **–ó–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints:** 21 (requireAuth/requireAdmin)
- **–ü—É–±–ª–∏—á–Ω—ã—Ö endpoints:** 8 (–¥–ª—è –ø–ª–µ–µ—Ä–æ–≤ –±–µ–∑ auth)
- **Rate limiting:** 10 endpoints
- **Critical routes:**
  - `/api/auth/*` - JWT authentication
  - `/api/devices/*` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
  - `/api/files/*` - —Ñ–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  - `/api/files/resolve/{device}/{file}` - resolver –¥–ª—è shared storage

**–í—ã–≤–æ–¥:** ‚úÖ API –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—â–∏—â–µ–Ω–æ

---

### ‚úÖ –¢–µ—Å—Ç 3: Frontend –õ–æ–≥–∏–∫–∞
**–°—Ç–∞—Ç—É—Å:** –ü–†–û–ô–î–ï–ù

- **Admin –º–æ–¥—É–ª–µ–π:** 13 (–º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **Speaker –º–æ–¥—É–ª–µ–π:** 1
- **Player:** 1 (player-videojs.js)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
  - `refreshFilesPanel` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ (9 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π)
  - `selectDevice` - –≤—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (5 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π)
  - `showPlaceholder` - –∑–∞–≥–ª—É—à–∫–∞ (7 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ `content()` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/files/resolve`
- ‚úÖ –°–∫—Ä—ã—Ç–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ó–∞–≥–ª—É—à–∫–∞ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–∞—è –≤ —Å–ø–∏—Å–∫–µ
- ‚úÖ –î–≤–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (displayExt, safeExt)

**–í—ã–≤–æ–¥:** ‚úÖ Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### ‚úÖ –¢–µ—Å—Ç 4: Android –ö–ª–∏–µ–Ω—Ç
**–°—Ç–∞—Ç—É—Å:** –ü–†–û–ô–î–ï–ù

- **–í–∏–¥–µ–æ:** `/api/files/resolve` ‚úÖ
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** `/api/files/resolve` ‚úÖ
- **PDF:** `/api/devices/{id}/converted/{file}/page/{page}` ‚úÖ
- **PPTX:** `/api/devices/{id}/converted/{file}/slide/{slide}` ‚úÖ
- **Folders:** `/api/devices/{id}/folder/{folder}/image/{num}` ‚úÖ

**APK:** VCMplayer-v2.5.5.apk (9.5 MB)

**–í—ã–≤–æ–¥:** ‚úÖ Android –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ API

---

### ‚úÖ –¢–µ—Å—Ç 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–°—Ç–∞—Ç—É—Å:** –ü–†–û–ô–î–ï–ù

- **Try-catch –±–ª–æ–∫–∏:** 83
- **Error handlers:** 2 (Socket.IO)
- **Process handlers:** 4
  - `SIGTERM` ‚Üí graceful shutdown
  - `SIGINT` ‚Üí graceful shutdown
  - `uncaughtException` ‚Üí log + shutdown
  - `unhandledRejection` ‚Üí log

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:**
- ‚úÖ Graceful shutdown
- ‚úÖ FFmpeg timeout (30s/30min)
- ‚úÖ Memory leak prevention
- ‚úÖ HTTP status codes (416, 507, 413, 415)

**–í—ã–≤–æ–¥:** ‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### ‚úÖ –¢–µ—Å—Ç 6: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
**–°—Ç–∞—Ç—É—Å:** –ü–†–û–ô–î–ï–ù

- **Sanitization:** 30 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π `sanitizeDeviceId`
- **Auth middleware:** 21 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **Rate limiting:** 10 endpoints
- **JWT tokens:** 11 –æ–ø–µ—Ä–∞—Ü–∏–π (access + refresh)
- **SQL Injection:** ‚úÖ 29 prepared statements, 0 –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–∫—Ä–æ–º–µ init)
- **Path Traversal:** ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sanitizeDeviceId` –¥–ª—è –≤—Å–µ—Ö –ø—É—Ç–µ–π

**Audit Logging:**
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –õ–æ–≥–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è (Winston)

**–í—ã–≤–æ–¥:** ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ

---

## üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –ú–µ—Ä—Ç–≤—ã–π –∏–º–ø–æ—Ä—Ç `validatePath`
**–§–∞–π–ª:** `src/routes/files.js`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª—Å—è, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è  
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–¥–∞–ª–µ–Ω

### 2. ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–∞—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã –≤ shared storage –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –∏ –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –≤ –ø–∞–ø–∫–µ  
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ `updateDeviceFilesFromDB`

### 3. ‚ùå –ù–µ–ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞–ø–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –ø–∞–ø–∫—É  
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ Frontend –ø–µ—Ä–µ–¥–∞–µ—Ç `expectedFiles[]`

### 4. ‚ùå Android —Å—Ç–∞—Ä—ã–π URL
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ª–µ–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `/content/{device}/` –≤–º–µ—Å—Ç–æ `/api/files/resolve`  
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã `playVideo` –∏ `showImage`

---

## üìà –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ú–æ–¥—É–ª–µ–π | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –°—Ç–∞—Ç—É—Å |
|-----------|---------|------------|--------|
| Backend | 40+ | ~8000 | ‚úÖ |
| Frontend | 20+ | ~5000 | ‚úÖ |
| Android | 1 | ~1100 | ‚úÖ |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | SQLite | 8 —Ç–∞–±–ª–∏—Ü | ‚úÖ |

**–ó–∞—â–∏—Ç–∞:**
- üîê JWT Auth (access + refresh)
- üö´ Rate limiting (10 endpoints)
- üõ°Ô∏è SQL prepared statements (29)
- üßπ Sanitization (30 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π)
- üìù Audit logging (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

**Production-ready:**
- ‚úÖ Graceful shutdown
- ‚úÖ Memory leak prevention
- ‚úÖ FFmpeg timeout protection
- ‚úÖ Structured logging (Winston)
- ‚úÖ Error handling (83 try-catch)

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é 24/7.**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –û–±–Ω–æ–≤–∏—Ç—å APK –Ω–∞ –≤—Å–µ—Ö Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö ‚Üí v2.5.5
2. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–æ–≤ (Ctrl+Shift+R)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞

**–í–µ—Ä—Å–∏—è –¥–ª—è —Ä–µ–ª–∏–∑–∞:** v2.6.2

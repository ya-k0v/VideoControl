# üöÄ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ Android MediaPlayer –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (SERVER_URL –∏ DEVICE_ID) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. **BroadcastReceiver** 
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:
- `BOOT_COMPLETED` - –æ–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Android
- `LOCKED_BOOT_COMPLETED` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (Android 7+)
- `QUICKBOOT_POWERON` - –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏)

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫**
–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
```kotlin
if (SettingsActivity.isConfigured(context)) {
    // ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º MainActivity
    startActivity(MainActivity)
} else {
    // ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ù–ï –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Üí –ù–ï –∑–∞–ø—É—Å–∫–∞–µ–º (–∏–∑–±–µ–≥–∞–µ–º –∫—Ä–∞—à)
}
```

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫**
–ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç MainActivity
2. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ Socket.IO
3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
4. –ñ–¥—ë—Ç –∫–æ–º–∞–Ω–¥ –æ—Ç –∞–¥–º–∏–Ω–∫–∏

---

## üìã –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ

```xml
<!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ -->
<uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />

<!-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–ª—è –∫–∏–æ—Å–∫-—Ä–µ–∂–∏–º–∞ -->
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
<uses-permission android:name="android.permission.DISABLE_KEYGUARD" />
```

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫):

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ APK:**
   ```bash
   adb install app-debug.apk
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫):
   - SERVER_URL: `http://192.168.1.100:3000`
   - DEVICE_ID: `display-1`
   - –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

3. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:**
   ```bash
   adb reboot
   ```

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   - ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - ‚úÖ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
   - ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ

---

## üè¢ –ö–∏–æ—Å–∫-—Ä–µ–∂–∏–º (–ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ **—Ç–æ–ª—å–∫–æ** –∫–∞–∫ –¥–∏—Å–ø–ª–µ—è:

### Android 9+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

1. **–í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞–¥–∞—á:**
   ```bash
   # –ß–µ—Ä–µ–∑ ADB
   adb shell settings put global policy_control immersive.full=com.videocontrol.mediaplayer
   ```

2. **–ò–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - Settings ‚Üí Security ‚Üí Screen pinning
   - –í–∫–ª—é—á–∏—Ç–µ Screen pinning
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ "–∑–∞–∫—Ä–µ–ø–∏—Ç–µ" –µ–≥–æ (Recent apps ‚Üí Pin)

### Android 5+ (—Å—Ç–∞—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞):

1. **Device Owner —Ä–µ–∂–∏–º:**
   ```bash
   adb shell dpm set-device-owner com.videocontrol.mediaplayer/.AdminReceiver
   ```
   
   ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –±–µ–∑ Google –∞–∫–∫–∞—É–Ω—Ç–æ–≤

---

## üîí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∏–æ—Å–∫–∞

### 1. –û—Ç–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫—É Home
```bash
adb shell pm disable-user --user 0 com.android.launcher3
```

### 2. –û—Ç–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```bash
adb shell settings put global heads_up_notifications_enabled 0
```

### 3. –û—Ç–∫–ª—é—á–∏—Ç—å —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º
```bash
adb shell settings put system screen_off_timeout 2147483647
```

### 4. –°–∫—Ä—ã—Ç—å —Å—Ç—Ä–æ–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
adb shell settings put global policy_control immersive.status=*
```

### 5. –ó–∞–ø—Ä–µ—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
```bash
adb shell pm disable-user --user 0 com.android.vending
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

### 1. –¢–µ—Å—Ç —á–µ—Ä–µ–∑ ADB:
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ BOOT_COMPLETED –≤—Ä—É—á–Ω—É—é (—Ç—Ä–µ–±—É–µ—Ç root)
adb shell am broadcast -a android.intent.action.BOOT_COMPLETED
```

### 2. –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É:
```bash
adb reboot
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ ~30 —Å–µ–∫—É–Ω–¥
adb logcat | grep BootReceiver
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
D/BootReceiver: üì± Boot completed detected: android.intent.action.BOOT_COMPLETED
D/BootReceiver: ‚úÖ Configuration found, launching MainActivity
D/BootReceiver: üöÄ MainActivity launched successfully
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è):
```bash
adb shell
cd /data/data/com.videocontrol.mediaplayer/shared_prefs
cat com.videocontrol.mediaplayer_preferences.xml
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã:
```xml
<string name="server_url">http://192.168.1.100:3000</string>
<string name="device_id">display-1</string>
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### Samsung tablets:
```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å Samsung Knox (–µ—Å–ª–∏ –µ—Å—Ç—å)
adb shell pm disable-user --user 0 com.samsung.android.knox.containeragent
```

### Xiaomi devices:
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö MIUI
adb shell pm grant com.videocontrol.mediaplayer android.permission.SYSTEM_ALERT_WINDOW
```

### Huawei devices:
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adb shell am start -a huawei.intent.action.HSM_PROTECTED_APPS
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ—à–µ–Ω–∏—è:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   ```bash
   adb logcat | grep BootReceiver
   ```
   –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `‚ö†Ô∏è Configuration not found`, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
   ```bash
   adb shell dumpsys package com.videocontrol.mediaplayer | grep permission
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `android.permission.RECEIVE_BOOT_COMPLETED: granted=true`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞—Ç–∞—Ä–µ—é (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):**
   ```bash
   # –û—Ç–∫–ª—é—á–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –±–∞—Ç–∞—Ä–µ–∏
   adb shell dumpsys deviceidle whitelist +com.videocontrol.mediaplayer
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è:**
   - Samsung: Settings ‚Üí Apps ‚Üí VideoControl ‚Üí Battery ‚Üí Unrestricted
   - Xiaomi: Settings ‚Üí Battery ‚Üí App battery saver ‚Üí VideoControl ‚Üí No restrictions
   - Huawei: Settings ‚Üí Battery ‚Üí App launch ‚Üí VideoControl ‚Üí Manual ‚Üí Allow all

---

## üìä –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adb logcat | grep -E "BootReceiver|MainActivity|VCMediaPlayer"

# –¢–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
adb logcat | grep BOOT_COMPLETED

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
adb logcat | grep "Socket"
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production

### 1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP –∏–ª–∏ DNS**
–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ DHCP –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞:
```kotlin
SERVER_URL = "http://display-server.local:3000"  // DNS
// –ò–õ–ò
SERVER_URL = "http://192.168.1.100:3000"         // Static IP
```

### 2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ watchdog**
–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:
```kotlin
setInterval(60000) { // –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    if (!socket.isConnected()) {
        reconnect()
    }
}
```

### 3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª**
–î–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```kotlin
FileLogger.log("Boot completed at ${System.currentTimeMillis()}")
```

### 4. **Remote config**
–•—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```
GET /api/devices/:id/config
{
  "server_url": "http://...",
  "auto_restart_interval": 86400
}
```

---

## ‚úÖ Checklist –¥–ª—è production deployment

- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (SERVER_URL + DEVICE_ID)
- [ ] –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ reboot)
- [ ] –û—Ç–∫–ª—é—á–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞—Ç–∞—Ä–µ–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–∏–æ—Å–∫-—Ä–µ–∂–∏–º (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
- [ ] –û—Ç–∫–ª—é—á–µ–Ω —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º —ç–∫—Ä–∞–Ω–∞
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
- [ ] –õ–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] –ï—Å—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

---

## üöÄ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–µ Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
- ‚úÖ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –ì–æ—Ç–æ–≤–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç 24/7 –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:**
- üè¢ Digital signage (—Ä–µ–∫–ª–∞–º–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö)
- üè´ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∏—Å–ø–ª–µ–∏ (—à–∫–æ–ª—ã, –≤—É–∑—ã)
- üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä—ã
- üé§ –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã
- üì∫ Home automation –¥–∏—Å–ø–ª–µ–∏


# VideoControl MPV Client

–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ MPV –ø–ª–µ–µ—Ä.  
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è Raspberry Pi –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ MPV (MP4, WebM, OGG, MKV, MOV, AVI)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (PNG, JPG, JPEG, GIF, WebP)
- ‚úÖ –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ PDF (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ PNG –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- ‚úÖ –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ PPTX (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ PNG –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ PDF/PPTX (Next/Prev –∫–Ω–æ–ø–∫–∏ –∏–∑ –ø–∞–Ω–µ–ª–∏ —Å–ø–∏–∫–µ—Ä–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥–ª—É—à–∫–∞ (loop default.mp4)
- ‚úÖ Real-time —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏
- ‚úÖ Hardware –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (GPU acceleration)
- ‚úÖ Fullscreen —Ä–µ–∂–∏–º
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ Systemd integration

## üî• –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ MPV

- **–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ RAM —á–µ–º VLC
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ª—É—á—à–µ –Ω–∞ —Å–ª–∞–±–æ–º –∂–µ–ª–µ–∑–µ
- **Hardware acceleration** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPU
- **Raspberry Pi –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ RPi

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MPV

**Ubuntu/Debian/Raspberry Pi OS:**
```bash
sudo apt install mpv libmpv-dev python3-pip
```

**macOS:**
```bash
brew install mpv
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd /vid/videocontrol/clients/mpv
pip3 install -r requirements.txt
```

## üöÄ –ó–∞–ø—É—Å–∫

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (—á–µ—Ä–µ–∑ Nginx):

```bash
python3 mpv_client.py --server http://192.168.1.100 --device mpv-001
```

### –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```bash
# –° –æ—Ç–ª–∞–¥–∫–æ–π (—á–µ—Ä–µ–∑ Nginx)
python3 mpv_client.py --server http://localhost --device rpi-test --debug

# –ë–µ–∑ hardware –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
python3 mpv_client.py --server http://localhost --device test --no-hwdec

# –ë–µ–∑ fullscreen
python3 mpv_client.py --server http://localhost --device test --no-fullscreen

# –ù–∞–ø—Ä—è–º—É—é –∫ Node.js (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ë–ï–ó Nginx)
python3 mpv_client.py --server http://localhost:3000 --device test --debug
```

### –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export VIDEOCONTROL_SERVER="http://192.168.1.100"
export VIDEOCONTROL_DEVICE_ID="rpi-tv-001"
python3 mpv_client.py
```

## ‚öôÔ∏è Systemd Service (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞ Raspberry Pi)

### 1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å service —Ñ–∞–π–ª:

```bash
nano videocontrol-mpv@.service
```

–ó–∞–º–µ–Ω–∏—Ç–µ:
- `YOUR_USERNAME` ‚Üí –≤–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—ã—á–Ω–æ `pi` –Ω–∞ Raspberry Pi)
- `VIDEOCONTROL_SERVER` ‚Üí URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å service:

```bash
sudo cp videocontrol-mpv@.service /etc/systemd/system/
sudo systemctl daemon-reload
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:

```bash
# –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ "rpi-hall-001"
sudo systemctl enable videocontrol-mpv@rpi-hall-001
sudo systemctl start videocontrol-mpv@rpi-hall-001

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status videocontrol-mpv@rpi-hall-001

# –õ–æ–≥–∏
sudo journalctl -u videocontrol-mpv@rpi-hall-001 -f
```

## üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|-----------------------|
| `--server`, `-s` | URL —Å–µ—Ä–≤–µ—Ä–∞ VideoControl | http://localhost (–ø–æ—Ä—Ç 80 —á–µ—Ä–µ–∑ Nginx) |
| `--device`, `-d` | ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | mpv-001 |
| `--no-fullscreen` | –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å fullscreen | false |
| `--no-hwdec` | –û—Ç–∫–ª—é—á–∏—Ç—å hardware –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ | false |
| `--debug` | –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è | false |

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ó–∞–ø—É—Å–∫:** –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ—Ç –∫—Ä—É—Ç–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É `default.mp4` –≤ loop
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ WebSocket (Socket.IO)
3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å —Ç–∏–ø–æ–º 'mpv'
4. **–û–∂–∏–¥–∞–Ω–∏–µ:** –ñ–¥–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (play, pause, stop, restart)
5. **–ö–æ–Ω—Ç–µ–Ω—Ç:** –ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `play` –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∑–∞–≥–ª—É—à–∫–µ
7. **–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å:** –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∫—Ä—É—Ç–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É

## üé¨ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```
[2025-11-02 15:30:00] üöÄ –ó–∞–ø—É—Å–∫ MPV –∫–ª–∏–µ–Ω—Ç–∞
[2025-11-02 15:30:00]    –°–µ—Ä–≤–µ—Ä: http://192.168.1.100:3000
[2025-11-02 15:30:00]    –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: rpi-001
[2025-11-02 15:30:00]    –ó–∞–≥–ª—É—à–∫–∞: http://192.168.1.100:3000/content/rpi-001/default.mp4
[2025-11-02 15:30:01] üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...
[2025-11-02 15:30:01] ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É http://192.168.1.100:3000
[2025-11-02 15:30:01] ‚úÖ –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω. –î–ª—è –≤—ã—Ö–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C
[2025-11-02 15:31:15] ‚ñ∂Ô∏è  –ö–æ–º–∞–Ω–¥–∞ PLAY: {'file': 'promo.mp4', 'type': 'video'}
[2025-11-02 15:31:15] üé¨ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: http://192.168.1.100:3000/content/rpi-001/promo.mp4
[2025-11-02 15:33:45] üì∫ –í–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
[2025-11-02 15:33:45] üîÑ –í–æ–∑–≤—Ä–∞—Ç –∫ –∑–∞–≥–ª—É—à–∫–µ...
```

## üçì Raspberry Pi –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –í–∫–ª—é—á–∏—Ç—å GPU acceleration:

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/boot/config.txt`:
```bash
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ:
gpu_mem=256
dtoverlay=vc4-kms-v3d
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Raspberry Pi.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Raspberry Pi:

- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Raspberry Pi 3B+ –∏–ª–∏ –Ω–æ–≤–µ–µ** –¥–ª—è 1080p –≤–∏–¥–µ–æ
- **Raspberry Pi 4** —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- **Raspberry Pi Zero** –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è 720p
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ** (5V 3A)
- **–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ** –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ

## üêõ Troubleshooting

### MPV –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ MPV —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
mpv --version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python –º–æ–¥—É–ª—å
python3 -c "import mpv; print('MPV OK')"
```

### –¢–æ—Ä–º–æ–∑–∏—Ç –≤–∏–¥–µ–æ –Ω–∞ Raspberry Pi

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–∫–ª—é—á–µ–Ω hardware –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
python3 mpv_client.py --server http://your-server --device test --debug

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ gpu_mem >= 256 –≤ /boot/config.txt
vcgencmd get_mem gpu
```

### –ù–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ Nginx (–ø–æ—Ä—Ç 80)
curl http://192.168.1.100/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –æ—Ç–ª–∞–¥–∫–æ–π
python3 mpv_client.py --server http://192.168.1.100 --device test --debug

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∫ Node.js (–µ—Å–ª–∏ Nginx –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
python3 mpv_client.py --server http://192.168.1.100:3000 --device test --debug
```

### Permission denied –¥–ª—è DISPLAY

–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —á–µ—Ä–µ–∑ systemd:
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ X11
xhost +local:

# –ò–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å X-—Å–µ—Ä–≤–µ—Ä–æ–º
```

## üìä –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:
- **CPU:** ARMv7 (Raspberry Pi 2+)
- **RAM:** 256 MB —Å–≤–æ–±–æ–¥–Ω–æ
- **–û–°:** Linux (Raspbian/Ubuntu)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:
- **CPU:** ARMv8 (Raspberry Pi 3B+/4)
- **RAM:** 512 MB —Å–≤–æ–±–æ–¥–Ω–æ
- **–û–°:** Raspberry Pi OS (64-bit)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å URL –∑–∞–≥–ª—É—à–∫–∏

–ó–∞–≥–ª—É—à–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
```
{server_url}/content/{device_id}/default.mp4
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ MPV –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `mpv_client.py`, —Å—Ç—Ä–æ–∫–∞ ~33:
```python
mpv_kwargs = {
    'input_default_bindings': True,
    'hwdec': 'auto',
    'fullscreen': True,
    # –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
}
```

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ VLC vs MPV

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | VLC | MPV |
|----------------|-----|-----|
| –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM | ~150-200 MB | ~80-120 MB |
| CPU –Ω–∞–≥—Ä—É–∑–∫–∞ | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è |
| GPU acceleration | –î–∞ | –î–∞ (–ª—É—á—à–µ) |
| Raspberry Pi | –†–∞–±–æ—Ç–∞–µ—Ç | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ ‚úì |
| –§–æ—Ä–º–∞—Ç—ã | –í—Å–µ | –í—Å–µ |
| –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ | –°—Ä–µ–¥–Ω—è—è | –ë—ã—Å—Ç—Ä–∞—è |

**–í—ã–≤–æ–¥:** –î–ª—è Raspberry Pi –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ MPV, –¥–ª—è desktop - VLC –∏–ª–∏ MPV –Ω–∞ –≤—ã–±–æ—Ä.

## üöÄ Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd service** –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
2. **–í–∫–ª—é—á–∏—Ç–µ hardware –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ Raspberry Pi
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ journald
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É** –Ω–∞ Raspberry Pi (`vcgencmd measure_temp`)
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é SD –∫–∞—Ä—Ç—É** (Class 10, A1/A2)

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ VideoControl

